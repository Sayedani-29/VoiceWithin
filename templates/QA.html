<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VoiceWithin — Survey</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif; background: #234;
      display: flex; justify-content: center; align-items: center;
      min-height: 100vh; margin: 0; padding: 70px 24px 40px;
    }
    .warning-box {
      position: fixed; top: 0; left: 0; width: 100%;
      background: #fff3cd; color: #856404; border-bottom: 1px solid #ffeeba;
      padding: 11px 20px; font-size: 14px; text-align: center; z-index: 1000;
    }
    /* step containers */
    .form-container, .survey-container {
      background: white; padding: 40px 44px; border-radius: 18px;
      box-shadow: 0 6px 28px rgba(0,0,0,0.2); width: 100%; max-width: 520px;
      text-align: left; display: none;
    }
    h2 { margin: 0 0 24px; font-size: 22px; color: #234; }

    label.field-label { display: block; margin-top: 18px; font-weight: bold; font-size: 15px; color: #234; }
    input[type="text"], input[type="number"], select {
      width: 100%; padding: 11px 14px; margin-top: 7px;
      border: 1.5px solid #d0d8de; border-radius: 9px; font-size: 15px; color: #234;
      transition: border-color 0.15s;
    }
    input:focus, select:focus { outline: none; border-color: #234; }

    .form-buttons { display: flex; justify-content: flex-end; margin-top: 28px; }
    .btn {
      padding: 12px 28px; background: #234; color: white;
      border: none; border-radius: 28px; font-size: 15px; font-weight: 700;
      cursor: pointer; transition: background 0.2s, transform 0.15s;
    }
    .btn:hover { background: #1a3038; transform: translateY(-1px); }

    .gender-row { display: flex; gap: 20px; margin-top: 10px; }
    .gender-row label { display: flex; align-items: center; gap: 8px; font-weight: normal; cursor: pointer; font-size: 15px; }

    /* survey options */
    .options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 28px; }
    label.option {
      display: flex; align-items: center; cursor: pointer;
      font-weight: normal; font-size: 15px; color: #1a2a34;
      padding: 12px 16px; border: 1.5px solid #e0e8ed; border-radius: 10px;
      transition: background 0.15s, border-color 0.15s;
    }
    label.option:hover { background: #f0f5f7; border-color: #aac; }
    input[type="radio"] { accent-color: #234; width: 16px; height: 16px; margin-right: 12px; flex-shrink: 0; }

    .survey-question { font-size: 17px; font-weight: 700; color: #234; margin: 0 0 22px; line-height: 1.5; }

    .buttons { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    #backToFormBtn { background: #667; display: none; }
    #prevBtn { margin-right: auto; }
    #nextBtn { margin-left: auto; }

    /* progress bar */
    .progress-bar-wrap { height: 5px; background: #e5eef2; border-radius: 4px; margin-bottom: 24px; }
    .progress-bar-fill { height: 100%; background: #234; border-radius: 4px; transition: width 0.3s; }

    @media (max-width: 600px) {
      .form-container, .survey-container { padding: 28px 20px; }
      h2 { font-size: 18px; }
      .btn { padding: 11px 22px; font-size: 14px; }
      label.option { padding: 11px 12px; font-size: 14px; }
    }
  </style>
</head>
<body>
  <div id="qna-warning" class="warning-box">⚠️ Please complete all questions before logging out.</div>

  <!-- Step 1 -->
  <div class="form-container" id="step1">
    <h2>Tell us about yourself</h2>
    <form id="formStep1">
      <label class="field-label">Q1. Choose your gender</label>
      <div class="gender-row">
        <label><input type="radio" name="gender" value="Male" required> Male</label>
        <label><input type="radio" name="gender" value="Female"> Female</label>
      </div>
      <label class="field-label" for="age">Q2. What is your age?</label>
      <input type="number" id="age" name="age" required min="1" step="1" inputmode="numeric" placeholder="e.g. 20">
      <div class="form-buttons"><button type="submit" class="btn">Next →</button></div>
    </form>
  </div>

  <!-- Step 2 -->
  <div class="form-container" id="step2">
    <h2>Education Details</h2>
    <form id="formStep2">
      <label class="field-label" for="course">Q3. Your current course / major</label>
      <input type="text" id="course" name="course" required placeholder="e.g. Computer Science">
      <label class="field-label" for="year">Q4. Which year are you in?</label>
      <select id="year" name="year" required>
        <option value="">-- Select Year --</option>
        <option>First</option><option>Second</option><option>Third</option><option>Fourth</option>
      </select>
      <div class="form-buttons"><button type="submit" class="btn">Next →</button></div>
    </form>
  </div>

  <!-- Step 3 -->
  <div class="survey-container" id="step3">
    <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressFill" style="width:0%"></div></div>
    <h2 id="questionText" class="survey-question"></h2>
    <div class="options" id="optionsContainer"></div>
    <div class="buttons">
      <button class="btn" id="backToFormBtn">← Back</button>
      <button class="btn" id="prevBtn">← Prev</button>
      <button class="btn" id="nextBtn">Next →</button>
    </div>
  </div>

  <script>
    const userData = {};
    let currentQuestion = 0;
    document.getElementById("step1").style.display = "block";

    document.getElementById("formStep1").addEventListener("submit", e => {
      e.preventDefault();
      const g = document.querySelector('input[name="gender"]:checked');
      userData["Choose your gender"] = g ? g.value : "";
      userData["Age"] = document.getElementById("age").value.trim();
      document.getElementById("step1").style.display = "none";
      document.getElementById("step2").style.display = "block";
    });

    document.getElementById("formStep2").addEventListener("submit", e => {
      e.preventDefault();
      userData["What is your course?"] = document.getElementById("course").value.trim();
      userData["Your current year"] = document.getElementById("year").value.trim();
      document.getElementById("step2").style.display = "none";
      document.getElementById("step3").style.display = "block";
      renderQuestion(0);
    });

    const questions = [
      { text: "Q5. Do you have Depression?", field: "Do you have Depression?", options: ["Yes","No"] },
      { text: "Q6. Do you have Anxiety?", field: "Do you have Anxiety?", options: ["Yes","No"] },
      { text: "Q7. Do you have Panic attacks?", field: "Do you have Panic attack?", options: ["Yes","No"] },
      { text: "Q8. Did you seek a specialist for treatment?", field: "Did you seek any specialist for a treatment?", options: ["Yes","No"] },
      { text: "Q9. Have you experienced thoughts of ending your life?", field: "Have you ever experienced thoughts of ending your life (suicidal ideation)?", options: ["Never","Rarely","Sometimes","Often","Always"] },
      { text: "Q10. Have you ever attempted to end your life?", field: "Have you ever attempted to end your life in the past?", options: ["Yes","No"] },
      { text: "Q11. Have you ever intentionally harmed yourself?", field: "Have you ever intentionally harmed yourself (e.g., cutting, burning, etc.)?", options: ["Yes","No"] },
      { text: "Q12. Do you feel hopeless about your future?", field: "Do you currently feel hopeless about your future?", options: ["Never","Rarely","Sometimes","Often","Always"] },
      { text: "Q13. Have you experienced bullying that hurt your mental health?", field: "Have you ever experienced bullying (in person or online) that negatively affected your mental health?", options: ["Yes","No"] },
      { text: "Q14. Are you facing serious family-related issues?", field: "Are you currently experiencing serious family-related issues (e.g., conflict, abuse, divorce, financial stress)?", options: ["Yes","No"] },
      { text: "Q15. Have you used substances to cope with stress?", field: "Have you used substances (e.g., alcohol, tobacco, recreational drugs) to cope with stress or emotions?", options: ["Yes","No"] }
    ];

    function updateProgress(idx) {
      document.getElementById('progressFill').style.width = ((idx / questions.length) * 100) + '%';
    }

    function renderQuestion(idx) {
      currentQuestion = idx;
      const q = questions[idx];
      document.getElementById("questionText").textContent = q.text;
      const container = document.getElementById("optionsContainer");
      container.innerHTML = "";
      q.options.forEach(opt => {
        const label = document.createElement("label");
        label.className = "option";
        const input = document.createElement("input");
        input.type = "radio"; input.name = "response"; input.value = opt;
        label.appendChild(input);
        label.appendChild(document.createTextNode(opt));
        container.appendChild(label);
      });
      document.getElementById("nextBtn").textContent = idx === questions.length - 1 ? "Submit ✓" : "Next →";
      document.getElementById("backToFormBtn").style.display = idx === 0 ? "inline-block" : "none";
      document.getElementById("prevBtn").style.display = idx === 0 ? "none" : "inline-block";
      updateProgress(idx);
    }

    document.getElementById("nextBtn").addEventListener("click", () => {
      const sel = document.querySelector('input[name="response"]:checked');
      if (!sel) { alert("Please select an option."); return; }
      userData[questions[currentQuestion].field] = sel.value;
      if (currentQuestion + 1 < questions.length) {
        renderQuestion(currentQuestion + 1);
      } else {
        updateProgress(questions.length);
        fetch("/predict", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify(userData) })
          .then(r=>r.json()).then(d=>{ if(d.redirect) window.location.href=d.redirect; })
          .catch(err=>alert("Error: "+err));
      }
    });

    document.getElementById("prevBtn").addEventListener("click", () => { if (currentQuestion > 0) renderQuestion(currentQuestion - 1); });
    document.getElementById("backToFormBtn").addEventListener("click", () => {
      document.getElementById("step3").style.display = "none";
      document.getElementById("step2").style.display = "block";
    });
  </script>
</body>
</html>